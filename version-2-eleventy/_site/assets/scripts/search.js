!function(){"use strict";const t={KeyCode:{BACKSPACE:8,TAB:9,RETURN:13,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46},Combobox:function(t,e,i){this.combobox=t,this.input=e,this.listbox=t.querySelector('[role="listbox"]'),this.status=t.querySelector('[role="status"]'),this.searchFn=i,this.shouldAutoSelect=!1,this.activeIndex=-1,this.resultsCount=0,this.shown=!1,this.setupEvents()}};t.Combobox.prototype.setupEvents=function(){document.body.addEventListener("click",this.checkHide.bind(this)),this.input.addEventListener("blur",this.checkHide.bind(this)),this.input.addEventListener("focus",this.checkShow.bind(this)),this.input.addEventListener("keyup",this.checkKey.bind(this)),this.input.addEventListener("keydown",this.setActiveOption.bind(this)),this.input.addEventListener("keypress",(e=>{e.keyCode===t.KeyCode.RETURN&&e.preventDefault()}))},t.Combobox.prototype.checkHide=function(t){t.target===this.input||this.combobox.contains(t.target)||this.hideListbox()},t.Combobox.prototype.checkShow=function(){this.updateResults()},t.Combobox.prototype.checkKey=function(e){switch(e.which||e.keyCode){case t.KeyCode.RETURN:case t.KeyCode.ESC:case t.KeyCode.PAGE_UP:case t.KeyCode.PAGE_DOWN:case t.KeyCode.END:case t.KeyCode.HOME:case t.KeyCode.UP:case t.KeyCode.DOWN:return void e.preventDefault();default:this.updateResults()}},t.Combobox.prototype.setActiveOption=function(e){const i=e.which||e.keyCode;let{activeIndex:o}=this;if(i===t.KeyCode.ESC)return this.hideListbox(),void(this.input.value="");const s=this.getOptionAt(o);let n;switch(i){case t.KeyCode.UP:if(0===o)return this.defocusOption(s),this.activeIndex=-1,void this.input.setAttribute("aria-activedescendant","");o--;break;case t.KeyCode.DOWN:if(o===this.resultsCount-1)return;o++;break;case t.KeyCode.HOME:case t.KeyCode.PAGE_UP:o=0;break;case t.KeyCode.END:case t.KeyCode.PAGE_DOWN:o=this.resultsCount-1;break;case t.KeyCode.RETURN:return n=this.getOptionAt(o),void this.selectOption(n);case t.KeyCode.TAB:return void this.hideListbox();default:return}e.preventDefault(),n=this.getOptionAt(o),this.activeIndex=o,s&&this.defocusOption(s),n?this.focusOption(n):this.input.setAttribute("aria-activedescendant","")},t.Combobox.prototype.updateResults=function(){const t=this.input.value,e=this.searchFn(t);if(this.hideListbox(),t.length>0&&e.length>0){for(let t=0;t<e.length;t++){const i=document.createElement("li");i.setAttribute("id","option-"+t),i.setAttribute("role","option"),i.setAttribute("tabindex","-1"),i.dataset.value=e[t].value,i.innerHTML=e[t].html,this.listbox.appendChild(i),this.shouldAutoSelect&&0===t&&(i.setAttribute("aria-selected","true"),this.activeIndex=0)}this.listbox.hidden=!1,this.combobox.setAttribute("aria-expanded","true"),this.resultsCount=e.length,this.shown=!0,this.updateStatus(this.resultsCount);const t=this.listbox.querySelectorAll("li");for(let e=0;e<t.length;e++)t[e].addEventListener("click",this.clickOption.bind(this))}},t.Combobox.prototype.updateStatus=function(t){this.status.innerText=`${t} results are available.`},t.Combobox.prototype.hideListbox=function(){this.shown=!1,this.activeIndex=-1,this.listbox.innerHTML="",this.listbox.hidden=!0,this.combobox.setAttribute("aria-expanded","false"),this.resultsCount=0,this.input.setAttribute("aria-activedescendant","")},t.Combobox.prototype.selectOption=function(t){if(t){const e=t.querySelector("a").getAttribute("href");document.location.href=e,this.hideListbox()}},t.Combobox.prototype.clickOption=function(t){this.focusOption(t.currentTarget),this.selectOption(t.currentTarget),t.preventDefault()},t.Combobox.prototype.getOptionAt=function(t){return document.getElementById("option-"+t)},t.Combobox.prototype.getIndexOf=function(t){const e=t.id.replace("option-","");return Number(e)+1},t.Combobox.prototype.focusOption=function(t){if(t.setAttribute("aria-selected","true"),this.input.setAttribute("aria-activedescendant",t.id),this.updateStatus(this.resultsCount),this.listbox.scrollHeight>this.listbox.clientHeight){const e=this.listbox.clientHeight+this.listbox.scrollTop,i=t.offsetTop+t.offsetHeight;i>e?this.listbox.scrollTop=i-this.listbox.clientHeight:t.offsetTop<this.listbox.scrollTop&&(this.listbox.scrollTop=t.offsetTop)}},t.Combobox.prototype.defocusOption=function(t){t&&t.setAttribute("aria-selected","false")};var e=t;!function(){const t=document.getElementById("search"),i=document.getElementById("search-submit"),o=t.dataset.searchIndex,s=[];function n(t){const e=function(t,e){return e.filter((e=>{const i=new RegExp(t,"gi");return e.title.match(i)}))}(t,s);return e.map((t=>{const e=`\n        <a class="form__option" href="${t.url}" aria-label="${t.title}">\n          <h3 class="form__option-title">${t.title}</h3>\n        </a>`;return{value:t.title,html:e}}))}document.querySelectorAll(".widget__search__button").forEach((t=>{let e=t.nextElementSibling;t.onclick=()=>{let i="true"==t.getAttribute("aria-expand")||!1;t.setAttribute("aria-expand",!i),e.classList.toggle("widget__search--visible"),e.hidden=i,document.getElementById("search-input").focus()}})),t&&(fetch(o).then((t=>t.json())).then((t=>s.push(...t))),t.setAttribute("action","#search"),t.removeAttribute("method"),i.parentNode.removeChild(i),window.addEventListener("load",(()=>new e.Combobox(document.getElementById("search-combobox"),document.getElementById("search-input"),n))))}()}();
//# sourceMappingURL=search.js.map
