{"version":3,"file":"search.js","sources":["../../../_includes/assets/scripts/modules/aria.js","../../../_includes/assets/scripts/modules/search.js","../../../_includes/assets/scripts/modules/toggleSearch.js","../../../_includes/assets/scripts/search.js"],"sourcesContent":["/**\n * @namespace aria\n */\nconst aria = {};\n\n/**\n * @desc Key code constants\n */\naria.KeyCode = {\n  BACKSPACE: 8,\n  TAB: 9,\n  RETURN: 13,\n  ESC: 27,\n  SPACE: 32,\n  PAGE_UP: 33,\n  PAGE_DOWN: 34,\n  END: 35,\n  HOME: 36,\n  LEFT: 37,\n  UP: 38,\n  RIGHT: 39,\n  DOWN: 40,\n  DELETE: 46\n};\n\n/**\n * @constructor\n *\n * @desc Combobox object representing the state and interactions for a combobox\n * @param {Object} comboboxNode The DOM node pointing to the combobox\n * @param {Object} inputNode The input node\n * @param {Function} searchFn Accepts a search string and returns an array\n */\naria.Combobox = function (\n  comboboxNode,\n  inputNode,\n  searchFn\n) {\n  this.combobox = comboboxNode;\n  this.input = inputNode;\n  this.listbox = comboboxNode.querySelector('[role=\"listbox\"]');\n  this.status = comboboxNode.querySelector('[role=\"status\"]');\n  this.searchFn = searchFn;\n  this.shouldAutoSelect = false;\n  this.activeIndex = -1;\n  this.resultsCount = 0;\n  this.shown = false;\n\n  this.setupEvents();\n};\n\n/**\n * @desc Setup events\n */\naria.Combobox.prototype.setupEvents = function () {\n  document.body.addEventListener('click', this.checkHide.bind(this));\n  this.input.addEventListener('blur', this.checkHide.bind(this));\n  this.input.addEventListener('focus', this.checkShow.bind(this));\n  this.input.addEventListener('keyup', this.checkKey.bind(this));\n  this.input.addEventListener('keydown', this.setActiveOption.bind(this));\n  this.input.addEventListener('keypress', event => {\n    if (event.keyCode === aria.KeyCode.RETURN) {\n      event.preventDefault();\n    }\n  });\n};\n\n/**\n * @desc Hide listbox on event\n * @param {Object} event Event\n */\naria.Combobox.prototype.checkHide = function (event) {\n  if (event.target === this.input || this.combobox.contains(event.target)) {\n    return;\n  }\n  this.hideListbox();\n};\n\n/**\n * @desc Show listbox on event\n */\naria.Combobox.prototype.checkShow = function () {\n  this.updateResults();\n};\n\n/**\n * @desc Check key press and override defaults\n * @param {Object} event Event\n */\naria.Combobox.prototype.checkKey = function (event) {\n  const key = event.which || event.keyCode;\n\n  switch (key) {\n    case aria.KeyCode.RETURN:\n    case aria.KeyCode.ESC:\n    case aria.KeyCode.PAGE_UP:\n    case aria.KeyCode.PAGE_DOWN:\n    case aria.KeyCode.END:\n    case aria.KeyCode.HOME:\n    case aria.KeyCode.UP:\n    case aria.KeyCode.DOWN:\n      event.preventDefault();\n      return;\n    default:\n      this.updateResults();\n  }\n};\n\n/**\n * @desc Highlight currently selected option\n * @param {Object} event Event\n */\naria.Combobox.prototype.setActiveOption = function (event) {\n  const key = event.which || event.keyCode;\n  let {activeIndex} = this;\n\n  if (key === aria.KeyCode.ESC) {\n    this.hideListbox();\n    this.input.value = '';\n    return;\n  }\n\n  const prevActive = this.getOptionAt(activeIndex);\n  let activeOption;\n\n  switch (key) {\n    case aria.KeyCode.UP:\n      if (activeIndex === 0) {\n        // Enable focus to be drawn back up to search input\n        this.defocusOption(prevActive);\n        this.activeIndex = -1;\n        this.input.setAttribute('aria-activedescendant', '');\n        return;\n      }\n      activeIndex--;\n      break;\n    case aria.KeyCode.DOWN:\n      if (activeIndex === this.resultsCount - 1) {\n        return;\n      }\n      activeIndex++;\n      break;\n    case aria.KeyCode.HOME:\n    case aria.KeyCode.PAGE_UP:\n      activeIndex = 0;\n      break;\n    case aria.KeyCode.END:\n    case aria.KeyCode.PAGE_DOWN:\n      activeIndex = this.resultsCount - 1;\n      break;\n    case aria.KeyCode.RETURN:\n      activeOption = this.getOptionAt(activeIndex);\n      this.selectOption(activeOption);\n      return;\n    case aria.KeyCode.TAB:\n      this.hideListbox();\n      return;\n    default:\n      return;\n  }\n\n  event.preventDefault();\n\n  activeOption = this.getOptionAt(activeIndex);\n  this.activeIndex = activeIndex;\n\n  if (prevActive) {\n    this.defocusOption(prevActive);\n  }\n\n  if (activeOption) {\n    this.focusOption(activeOption);\n  } else {\n    this.input.setAttribute('aria-activedescendant', '');\n  }\n};\n\n/**\n * @desc Update listbox results\n */\naria.Combobox.prototype.updateResults = function () {\n  const searchString = this.input.value;\n  const results = this.searchFn(searchString);\n\n  this.hideListbox();\n\n  if (searchString.length > 0 && results.length > 0) {\n    for (let i = 0; i < results.length; i++) {\n      const resultItem = document.createElement('li');\n      resultItem.setAttribute('id', 'option-' + i);\n      resultItem.setAttribute('role', 'option');\n      resultItem.setAttribute('tabindex', '-1');\n      resultItem.dataset.value = results[i].value;\n      resultItem.innerHTML = results[i].html;\n      this.listbox.appendChild(resultItem);\n      if (this.shouldAutoSelect && i === 0) {\n        resultItem.setAttribute('aria-selected', 'true');\n        this.activeIndex = 0;\n      }\n    }\n    this.listbox.hidden = false;\n    this.combobox.setAttribute('aria-expanded', 'true');\n    this.resultsCount = results.length;\n    this.shown = true;\n    this.updateStatus(this.resultsCount);\n\n    // Override default link behaviour to close listbox prior to location change\n    const listboxOptions = this.listbox.querySelectorAll('li');\n    for (let i = 0; i < listboxOptions.length; i++) {\n      listboxOptions[i].addEventListener('click', this.clickOption.bind(this));\n    }\n  }\n};\n\n/**\n * @desc Update status region\n * @param {Number} resultsCount Number of returned results\n * @param {Object} activeOption HTML element\n */\naria.Combobox.prototype.updateStatus = function (resultsCount) {\n  this.status.innerText = `${resultsCount} results are available.`;\n};\n\n/**\n * @desc Hide listbox\n */\naria.Combobox.prototype.hideListbox = function () {\n  this.shown = false;\n  this.activeIndex = -1;\n  this.listbox.innerHTML = '';\n  this.listbox.hidden = true;\n  this.combobox.setAttribute('aria-expanded', 'false');\n  this.resultsCount = 0;\n  this.input.setAttribute('aria-activedescendant', '');\n};\n\n/**\n * @desc Action to take when listbox option selected\n * @param {Object} element HTML element\n */\naria.Combobox.prototype.selectOption = function (element) {\n  if (element) {\n    const href = element.querySelector('a').getAttribute('href');\n    document.location.href = href;\n    this.hideListbox();\n  }\n};\n\n/**\n * @desc Action to take when listbox option clicked\n * @param {Object} event Event\n */\naria.Combobox.prototype.clickOption = function (event) {\n  this.focusOption(event.currentTarget);\n  this.selectOption(event.currentTarget);\n  event.preventDefault();\n};\n\n/**\n * @desc Get option at index\n * @param {Number} index Index\n * @returns {Object} element HTML element\n */\naria.Combobox.prototype.getOptionAt = function (index) {\n  return document.getElementById('option-' + index);\n};\n\n/**\n * @desc Get index of option\n * @param {Object} element HTML element\n * @returns {Number} Index\n */\naria.Combobox.prototype.getIndexOf = function (element) {\n  const id = element.id.replace('option-', '');\n  return Number(id) + 1;\n};\n\n/**\n * @desc Focus on the specified item\n * @param {Object} element HTML element\n */\naria.Combobox.prototype.focusOption = function (element) {\n  element.setAttribute('aria-selected', 'true');\n  this.input.setAttribute('aria-activedescendant', element.id);\n  // This makes no sense, but without updating the status region (and as\n  // this.resultsCount has not changed, no new status is announced), Safari\n  // will refuse to apply focus to selected option.\n  this.updateStatus(this.resultsCount);\n\n  if (this.listbox.scrollHeight > this.listbox.clientHeight) {\n    const scrollBottom = this.listbox.clientHeight + this.listbox.scrollTop;\n    const elementBottom = element.offsetTop + element.offsetHeight;\n    if (elementBottom > scrollBottom) {\n      this.listbox.scrollTop = elementBottom - this.listbox.clientHeight;\n    } else if (element.offsetTop < this.listbox.scrollTop) {\n      this.listbox.scrollTop = element.offsetTop;\n    }\n  }\n};\n\n/**\n * @desc Defocus the specified item\n * @param {Object} element HTML element\n */\naria.Combobox.prototype.defocusOption = function (element) {\n  if (!element) {\n    return;\n  }\n  element.setAttribute('aria-selected', 'false');\n};\n\nmodule.exports = aria;\n","import aria from './aria';\nimport toggleSearch from './toggleSearch';\n\nexport default function () {\n  const searchForm = document.getElementById('search');\n  const searchSubmit = document.getElementById('search-submit');\n  const endpoint = searchForm.dataset.searchIndex;\n  const pages = [];\n\n  toggleSearch();\n\n  function findResults(termToMatch, pages) {\n    return pages.filter(item => {\n      const regex = new RegExp(termToMatch, 'gi');\n      return item.title.match(regex);\n    });\n  }\n\n  function displayResults(input) {\n    const resultsArray = findResults(input, pages);\n    const result = resultsArray.map(item => {\n      const html = `\n        <a class=\"form__option\" href=\"${item.url}\" aria-label=\"${item.title}\">\n          <h3 class=\"form__option-title\">${item.title}</h3>\n        </a>`;\n\n      return {\n        value: item.title,\n        html\n      };\n    });\n\n    return result;\n  }\n\n  if (searchForm) {\n    fetch(endpoint)\n      .then(blob => blob.json())\n      .then(data => pages.push(...data));\n\n    searchForm.setAttribute('action', '#search');\n    searchForm.removeAttribute('method');\n    searchSubmit.parentNode.removeChild(searchSubmit);\n\n    window.addEventListener('load', () => {\n      return new aria.Combobox(\n        document.getElementById('search-combobox'),\n        document.getElementById('search-input'),\n        displayResults\n      );\n    });\n  }\n}","/**\n * @namespace toggleSearch\n */\nexport default function () {\n\n  const searchButtons = document.querySelectorAll('.widget__search__button');\n\n  searchButtons.forEach(searchButton => {\n    let target = searchButton.nextElementSibling;\n\n    searchButton.onclick = () => {\n        let expanded = searchButton.getAttribute('aria-expand') == 'true' || false;\n\n        searchButton.setAttribute('aria-expand', !expanded);\n        target.classList.toggle('widget__search--visible');\n        target.hidden = expanded;\n        document.getElementById('search-input').focus();\n    }\n  });\n\n};","import search from './modules/search';\n\nsearch();\n"],"names":["aria","BACKSPACE","TAB","RETURN","ESC","SPACE","PAGE_UP","PAGE_DOWN","END","HOME","LEFT","UP","RIGHT","DOWN","DELETE","comboboxNode","inputNode","searchFn","this","combobox","input","listbox","querySelector","status","shouldAutoSelect","activeIndex","resultsCount","shown","setupEvents","Combobox","prototype","document","body","addEventListener","checkHide","bind","checkShow","checkKey","setActiveOption","event","keyCode","KeyCode","preventDefault","target","contains","hideListbox","updateResults","which","key","value","prevActive","getOptionAt","activeOption","defocusOption","setAttribute","selectOption","focusOption","searchString","results","length","i","resultItem","createElement","dataset","innerHTML","html","appendChild","hidden","updateStatus","listboxOptions","querySelectorAll","clickOption","innerText","element","href","getAttribute","location","currentTarget","index","getElementById","getIndexOf","id","replace","Number","scrollHeight","clientHeight","scrollBottom","scrollTop","elementBottom","offsetTop","offsetHeight","aria_1","searchForm","searchSubmit","endpoint","searchIndex","pages","displayResults","resultsArray","termToMatch","filter","item","regex","RegExp","title","match","findResults","map","url","forEach","searchButton","nextElementSibling","onclick","expanded","classList","toggle","focus","fetch","then","blob","json","data","push","removeAttribute","parentNode","removeChild","window","search"],"mappings":"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"}