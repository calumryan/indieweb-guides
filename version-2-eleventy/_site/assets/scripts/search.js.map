{"version":3,"file":"search.js","sources":["../../../_includes/assets/scripts/modules/aria.js","../../../_includes/assets/scripts/modules/search.js","../../../_includes/assets/scripts/modules/toggleSearch.js"],"sourcesContent":["/**\n * @namespace aria\n */\nconst aria = {};\n\n/**\n * @desc Key code constants\n */\naria.KeyCode = {\n  BACKSPACE: 8,\n  TAB: 9,\n  RETURN: 13,\n  ESC: 27,\n  SPACE: 32,\n  PAGE_UP: 33,\n  PAGE_DOWN: 34,\n  END: 35,\n  HOME: 36,\n  LEFT: 37,\n  UP: 38,\n  RIGHT: 39,\n  DOWN: 40,\n  DELETE: 46\n};\n\n/**\n * @constructor\n *\n * @desc Combobox object representing the state and interactions for a combobox\n * @param {Object} comboboxNode The DOM node pointing to the combobox\n * @param {Object} inputNode The input node\n * @param {Function} searchFn Accepts a search string and returns an array\n */\naria.Combobox = function (\n  comboboxNode,\n  inputNode,\n  searchFn\n) {\n  this.combobox = comboboxNode;\n  this.input = inputNode;\n  this.listbox = comboboxNode.querySelector('[role=\"listbox\"]');\n  this.status = comboboxNode.querySelector('[role=\"status\"]');\n  this.searchFn = searchFn;\n  this.shouldAutoSelect = false;\n  this.activeIndex = -1;\n  this.resultsCount = 0;\n  this.shown = false;\n\n  this.setupEvents();\n};\n\n/**\n * @desc Setup events\n */\naria.Combobox.prototype.setupEvents = function () {\n  document.body.addEventListener('click', this.checkHide.bind(this));\n  this.input.addEventListener('blur', this.checkHide.bind(this));\n  this.input.addEventListener('focus', this.checkShow.bind(this));\n  this.input.addEventListener('keyup', this.checkKey.bind(this));\n  this.input.addEventListener('keydown', this.setActiveOption.bind(this));\n  this.input.addEventListener('keypress', event => {\n    if (event.keyCode === aria.KeyCode.RETURN) {\n      event.preventDefault();\n    }\n  });\n};\n\n/**\n * @desc Hide listbox on event\n * @param {Object} event Event\n */\naria.Combobox.prototype.checkHide = function (event) {\n  if (event.target === this.input || this.combobox.contains(event.target)) {\n    return;\n  }\n  this.hideListbox();\n};\n\n/**\n * @desc Show listbox on event\n */\naria.Combobox.prototype.checkShow = function () {\n  this.updateResults();\n};\n\n/**\n * @desc Check key press and override defaults\n * @param {Object} event Event\n */\naria.Combobox.prototype.checkKey = function (event) {\n  const key = event.which || event.keyCode;\n\n  switch (key) {\n    case aria.KeyCode.RETURN:\n    case aria.KeyCode.ESC:\n    case aria.KeyCode.PAGE_UP:\n    case aria.KeyCode.PAGE_DOWN:\n    case aria.KeyCode.END:\n    case aria.KeyCode.HOME:\n    case aria.KeyCode.UP:\n    case aria.KeyCode.DOWN:\n      event.preventDefault();\n      return;\n    default:\n      this.updateResults();\n  }\n};\n\n/**\n * @desc Highlight currently selected option\n * @param {Object} event Event\n */\naria.Combobox.prototype.setActiveOption = function (event) {\n  const key = event.which || event.keyCode;\n  let {activeIndex} = this;\n\n  if (key === aria.KeyCode.ESC) {\n    this.hideListbox();\n    this.input.value = '';\n    return;\n  }\n\n  const prevActive = this.getOptionAt(activeIndex);\n  let activeOption;\n\n  switch (key) {\n    case aria.KeyCode.UP:\n      if (activeIndex === 0) {\n        // Enable focus to be drawn back up to search input\n        this.defocusOption(prevActive);\n        this.activeIndex = -1;\n        this.input.setAttribute('aria-activedescendant', '');\n        return;\n      }\n      activeIndex--;\n      break;\n    case aria.KeyCode.DOWN:\n      if (activeIndex === this.resultsCount - 1) {\n        return;\n      }\n      activeIndex++;\n      break;\n    case aria.KeyCode.HOME:\n    case aria.KeyCode.PAGE_UP:\n      activeIndex = 0;\n      break;\n    case aria.KeyCode.END:\n    case aria.KeyCode.PAGE_DOWN:\n      activeIndex = this.resultsCount - 1;\n      break;\n    case aria.KeyCode.RETURN:\n      activeOption = this.getOptionAt(activeIndex);\n      this.selectOption(activeOption);\n      return;\n    case aria.KeyCode.TAB:\n      this.hideListbox();\n      return;\n    default:\n      return;\n  }\n\n  event.preventDefault();\n\n  activeOption = this.getOptionAt(activeIndex);\n  this.activeIndex = activeIndex;\n\n  if (prevActive) {\n    this.defocusOption(prevActive);\n  }\n\n  if (activeOption) {\n    this.focusOption(activeOption);\n  } else {\n    this.input.setAttribute('aria-activedescendant', '');\n  }\n};\n\n/**\n * @desc Update listbox results\n */\naria.Combobox.prototype.updateResults = function () {\n  const searchString = this.input.value;\n  const results = this.searchFn(searchString);\n\n  this.hideListbox();\n\n  if (searchString.length > 0 && results.length > 0) {\n    for (let i = 0; i < results.length; i++) {\n      const resultItem = document.createElement('li');\n      resultItem.setAttribute('id', 'option-' + i);\n      resultItem.setAttribute('role', 'option');\n      resultItem.setAttribute('tabindex', '-1');\n      resultItem.dataset.value = results[i].value;\n      resultItem.innerHTML = results[i].html;\n      this.listbox.appendChild(resultItem);\n      if (this.shouldAutoSelect && i === 0) {\n        resultItem.setAttribute('aria-selected', 'true');\n        this.activeIndex = 0;\n      }\n    }\n    this.listbox.hidden = false;\n    this.combobox.setAttribute('aria-expanded', 'true');\n    this.resultsCount = results.length;\n    this.shown = true;\n    this.updateStatus(this.resultsCount);\n\n    // Override default link behaviour to close listbox prior to location change\n    const listboxOptions = this.listbox.querySelectorAll('li');\n    for (let i = 0; i < listboxOptions.length; i++) {\n      listboxOptions[i].addEventListener('click', this.clickOption.bind(this));\n    }\n  }\n};\n\n/**\n * @desc Update status region\n * @param {Number} resultsCount Number of returned results\n * @param {Object} activeOption HTML element\n */\naria.Combobox.prototype.updateStatus = function (resultsCount) {\n  this.status.innerText = `${resultsCount} results are available.`;\n};\n\n/**\n * @desc Hide listbox\n */\naria.Combobox.prototype.hideListbox = function () {\n  this.shown = false;\n  this.activeIndex = -1;\n  this.listbox.innerHTML = '';\n  this.listbox.hidden = true;\n  this.combobox.setAttribute('aria-expanded', 'false');\n  this.resultsCount = 0;\n  this.input.setAttribute('aria-activedescendant', '');\n};\n\n/**\n * @desc Action to take when listbox option selected\n * @param {Object} element HTML element\n */\naria.Combobox.prototype.selectOption = function (element) {\n  if (element) {\n    const href = element.querySelector('a').getAttribute('href');\n    document.location.href = href;\n    this.hideListbox();\n  }\n};\n\n/**\n * @desc Action to take when listbox option clicked\n * @param {Object} event Event\n */\naria.Combobox.prototype.clickOption = function (event) {\n  this.focusOption(event.currentTarget);\n  this.selectOption(event.currentTarget);\n  event.preventDefault();\n};\n\n/**\n * @desc Get option at index\n * @param {Number} index Index\n * @returns {Object} element HTML element\n */\naria.Combobox.prototype.getOptionAt = function (index) {\n  return document.getElementById('option-' + index);\n};\n\n/**\n * @desc Get index of option\n * @param {Object} element HTML element\n * @returns {Number} Index\n */\naria.Combobox.prototype.getIndexOf = function (element) {\n  const id = element.id.replace('option-', '');\n  return Number(id) + 1;\n};\n\n/**\n * @desc Focus on the specified item\n * @param {Object} element HTML element\n */\naria.Combobox.prototype.focusOption = function (element) {\n  element.setAttribute('aria-selected', 'true');\n  this.input.setAttribute('aria-activedescendant', element.id);\n  // This makes no sense, but without updating the status region (and as\n  // this.resultsCount has not changed, no new status is announced), Safari\n  // will refuse to apply focus to selected option.\n  this.updateStatus(this.resultsCount);\n\n  if (this.listbox.scrollHeight > this.listbox.clientHeight) {\n    const scrollBottom = this.listbox.clientHeight + this.listbox.scrollTop;\n    const elementBottom = element.offsetTop + element.offsetHeight;\n    if (elementBottom > scrollBottom) {\n      this.listbox.scrollTop = elementBottom - this.listbox.clientHeight;\n    } else if (element.offsetTop < this.listbox.scrollTop) {\n      this.listbox.scrollTop = element.offsetTop;\n    }\n  }\n};\n\n/**\n * @desc Defocus the specified item\n * @param {Object} element HTML element\n */\naria.Combobox.prototype.defocusOption = function (element) {\n  if (!element) {\n    return;\n  }\n  element.setAttribute('aria-selected', 'false');\n};\n\nmodule.exports = aria;\n","import aria from './aria';\nimport toggleSearch from './toggleSearch';\n\nexport default function () {\n  const searchForm = document.getElementById('search');\n  const searchSubmit = document.getElementById('search-submit');\n  const endpoint = searchForm.dataset.searchIndex;\n  const pages = [];\n\n  toggleSearch();\n\n  function findResults(termToMatch, pages) {\n    return pages.filter(item => {\n      const regex = new RegExp(termToMatch, 'gi');\n      return item.title.match(regex);\n    });\n  }\n\n  function displayResults(input) {\n    const resultsArray = findResults(input, pages);\n    const result = resultsArray.map(item => {\n      const html = `\n        <a class=\"form__option\" href=\"${item.url}\" aria-label=\"${item.title}\">\n          <h3 class=\"form__option-title\">${item.title}</h3>\n        </a>`;\n\n      return {\n        value: item.title,\n        html\n      };\n    });\n\n    return result;\n  }\n\n  if (searchForm) {\n    fetch(endpoint)\n      .then(blob => blob.json())\n      .then(data => pages.push(...data));\n\n    searchForm.setAttribute('action', '#search');\n    searchForm.removeAttribute('method');\n    searchSubmit.parentNode.removeChild(searchSubmit);\n\n    window.addEventListener('load', () => {\n      return new aria.Combobox(\n        document.getElementById('search-combobox'),\n        document.getElementById('search-input'),\n        displayResults\n      );\n    });\n  }\n}","/**\n * @namespace toggleSearch\n */\nexport default function () {\n\n  const searchButtons = document.querySelectorAll('.widget__search__button');\n\n  searchButtons.forEach(searchButton => {\n    let target = searchButton.nextElementSibling;\n\n    searchButton.onclick = () => {\n        let expanded = searchButton.getAttribute('aria-expand') == 'true' || false;\n\n        searchButton.setAttribute('aria-expand', !expanded);\n        target.classList.toggle('widget__search--visible');\n        target.hidden = expanded;\n        document.getElementById('search-input').focus();\n    }\n  });\n\n};"],"names":["aria","KeyCode","BACKSPACE","TAB","RETURN","ESC","SPACE","PAGE_UP","PAGE_DOWN","END","HOME","LEFT","UP","RIGHT","DOWN","DELETE","Combobox","comboboxNode","inputNode","searchFn","this","combobox","input","listbox","querySelector","status","shouldAutoSelect","activeIndex","resultsCount","shown","setupEvents","prototype","document","body","addEventListener","checkHide","bind","checkShow","checkKey","setActiveOption","event","keyCode","preventDefault","target","contains","hideListbox","updateResults","which","key","value","prevActive","getOptionAt","activeOption","defocusOption","setAttribute","selectOption","focusOption","searchString","results","length","i","resultItem","createElement","dataset","innerHTML","html","appendChild","hidden","updateStatus","listboxOptions","querySelectorAll","clickOption","innerText","element","href","getAttribute","location","currentTarget","index","getElementById","getIndexOf","id","replace","Number","scrollHeight","clientHeight","scrollBottom","scrollTop","elementBottom","offsetTop","offsetHeight","searchForm","searchSubmit","endpoint","searchIndex","pages","displayResults","termToMatch","filter","item","regex","RegExp","title","match","findResults","map","url","forEach","searchButton","nextElementSibling","onclick","expanded","classList","toggle","focus","fetch","then","blob","json","data","push","removeAttribute","parentNode","removeChild","window"],"mappings":"yBAGA,MAAMA,EAAO,CAKbC,QAAe,CACbC,UAAW,EACXC,IAAK,EACLC,OAAQ,GACRC,IAAK,GACLC,MAAO,GACPC,QAAS,GACTC,UAAW,GACXC,IAAK,GACLC,KAAM,GACNC,KAAM,GACNC,GAAI,GACJC,MAAO,GACPC,KAAM,GACNC,OAAQ,IAWVC,SAAgB,SACdC,EACAC,EACAC,GAEAC,KAAKC,SAAWJ,EAChBG,KAAKE,MAAQJ,EACbE,KAAKG,QAAUN,EAAaO,cAAc,oBAC1CJ,KAAKK,OAASR,EAAaO,cAAc,mBACzCJ,KAAKD,SAAWA,EAChBC,KAAKM,kBAAmB,EACxBN,KAAKO,aAAe,EACpBP,KAAKQ,aAAe,EACpBR,KAAKS,OAAQ,EAEbT,KAAKU,gBAMP9B,EAAKgB,SAASe,UAAUD,YAAc,WACpCE,SAASC,KAAKC,iBAAiB,QAASd,KAAKe,UAAUC,KAAKhB,OAC5DA,KAAKE,MAAMY,iBAAiB,OAAQd,KAAKe,UAAUC,KAAKhB,OACxDA,KAAKE,MAAMY,iBAAiB,QAASd,KAAKiB,UAAUD,KAAKhB,OACzDA,KAAKE,MAAMY,iBAAiB,QAASd,KAAKkB,SAASF,KAAKhB,OACxDA,KAAKE,MAAMY,iBAAiB,UAAWd,KAAKmB,gBAAgBH,KAAKhB,OACjEA,KAAKE,MAAMY,iBAAiB,WAAYM,IAClCA,EAAMC,UAAYzC,EAAKC,QAAQG,QACjCoC,EAAME,oBASZ1C,EAAKgB,SAASe,UAAUI,UAAY,SAAUK,GACxCA,EAAMG,SAAWvB,KAAKE,OAASF,KAAKC,SAASuB,SAASJ,EAAMG,SAGhEvB,KAAKyB,eAMP7C,EAAKgB,SAASe,UAAUM,UAAY,WAClCjB,KAAK0B,iBAOP9C,EAAKgB,SAASe,UAAUO,SAAW,SAAUE,GAG3C,OAFYA,EAAMO,OAASP,EAAMC,SAG/B,KAAKzC,EAAKC,QAAQG,OAClB,KAAKJ,EAAKC,QAAQI,IAClB,KAAKL,EAAKC,QAAQM,QAClB,KAAKP,EAAKC,QAAQO,UAClB,KAAKR,EAAKC,QAAQQ,IAClB,KAAKT,EAAKC,QAAQS,KAClB,KAAKV,EAAKC,QAAQW,GAClB,KAAKZ,EAAKC,QAAQa,KAEhB,YADA0B,EAAME,iBAER,QACEtB,KAAK0B,kBAQX9C,EAAKgB,SAASe,UAAUQ,gBAAkB,SAAUC,GAClD,MAAMQ,EAAMR,EAAMO,OAASP,EAAMC,QACjC,IAAId,YAACA,GAAeP,KAEpB,GAAI4B,IAAQhD,EAAKC,QAAQI,IAGvB,OAFAe,KAAKyB,mBACLzB,KAAKE,MAAM2B,MAAQ,IAIrB,MAAMC,EAAa9B,KAAK+B,YAAYxB,GACpC,IAAIyB,EAEJ,OAAQJ,GACN,KAAKhD,EAAKC,QAAQW,GAChB,GAAoB,IAAhBe,EAKF,OAHAP,KAAKiC,cAAcH,GACnB9B,KAAKO,aAAe,OACpBP,KAAKE,MAAMgC,aAAa,wBAAyB,IAGnD3B,IACA,MACF,KAAK3B,EAAKC,QAAQa,KAChB,GAAIa,IAAgBP,KAAKQ,aAAe,EACtC,OAEFD,IACA,MACF,KAAK3B,EAAKC,QAAQS,KAClB,KAAKV,EAAKC,QAAQM,QAChBoB,EAAc,EACd,MACF,KAAK3B,EAAKC,QAAQQ,IAClB,KAAKT,EAAKC,QAAQO,UAChBmB,EAAcP,KAAKQ,aAAe,EAClC,MACF,KAAK5B,EAAKC,QAAQG,OAGhB,OAFAgD,EAAehC,KAAK+B,YAAYxB,QAChCP,KAAKmC,aAAaH,GAEpB,KAAKpD,EAAKC,QAAQE,IAEhB,YADAiB,KAAKyB,cAEP,QACE,OAGJL,EAAME,iBAENU,EAAehC,KAAK+B,YAAYxB,GAChCP,KAAKO,YAAcA,EAEfuB,GACF9B,KAAKiC,cAAcH,GAGjBE,EACFhC,KAAKoC,YAAYJ,GAEjBhC,KAAKE,MAAMgC,aAAa,wBAAyB,KAOrDtD,EAAKgB,SAASe,UAAUe,cAAgB,WACtC,MAAMW,EAAerC,KAAKE,MAAM2B,MAC1BS,EAAUtC,KAAKD,SAASsC,GAI9B,GAFArC,KAAKyB,cAEDY,EAAaE,OAAS,GAAKD,EAAQC,OAAS,EAAG,CACjD,IAAK,IAAIC,EAAI,EAAGA,EAAIF,EAAQC,OAAQC,IAAK,CACvC,MAAMC,EAAa7B,SAAS8B,cAAc,MAC1CD,EAAWP,aAAa,KAAM,UAAYM,GAC1CC,EAAWP,aAAa,OAAQ,UAChCO,EAAWP,aAAa,WAAY,MACpCO,EAAWE,QAAQd,MAAQS,EAAQE,GAAGX,MACtCY,EAAWG,UAAYN,EAAQE,GAAGK,KAClC7C,KAAKG,QAAQ2C,YAAYL,GACrBzC,KAAKM,kBAA0B,IAANkC,IAC3BC,EAAWP,aAAa,gBAAiB,QACzClC,KAAKO,YAAc,GAGvBP,KAAKG,QAAQ4C,QAAS,EACtB/C,KAAKC,SAASiC,aAAa,gBAAiB,QAC5ClC,KAAKQ,aAAe8B,EAAQC,OAC5BvC,KAAKS,OAAQ,EACbT,KAAKgD,aAAahD,KAAKQ,cAGvB,MAAMyC,EAAiBjD,KAAKG,QAAQ+C,iBAAiB,MACrD,IAAK,IAAIV,EAAI,EAAGA,EAAIS,EAAeV,OAAQC,IACzCS,EAAeT,GAAG1B,iBAAiB,QAASd,KAAKmD,YAAYnC,KAAKhB,SAUxEpB,EAAKgB,SAASe,UAAUqC,aAAe,SAAUxC,GAC/CR,KAAKK,OAAO+C,UAAe5C,EAAH,2BAM1B5B,EAAKgB,SAASe,UAAUc,YAAc,WACpCzB,KAAKS,OAAQ,EACbT,KAAKO,aAAe,EACpBP,KAAKG,QAAQyC,UAAY,GACzB5C,KAAKG,QAAQ4C,QAAS,EACtB/C,KAAKC,SAASiC,aAAa,gBAAiB,SAC5ClC,KAAKQ,aAAe,EACpBR,KAAKE,MAAMgC,aAAa,wBAAyB,KAOnDtD,EAAKgB,SAASe,UAAUwB,aAAe,SAAUkB,GAC/C,GAAIA,EAAS,CACX,MAAMC,EAAOD,EAAQjD,cAAc,KAAKmD,aAAa,QACrD3C,SAAS4C,SAASF,KAAOA,EACzBtD,KAAKyB,gBAQT7C,EAAKgB,SAASe,UAAUwC,YAAc,SAAU/B,GAC9CpB,KAAKoC,YAAYhB,EAAMqC,eACvBzD,KAAKmC,aAAaf,EAAMqC,eACxBrC,EAAME,kBAQR1C,EAAKgB,SAASe,UAAUoB,YAAc,SAAU2B,GAC9C,OAAO9C,SAAS+C,eAAe,UAAYD,IAQ7C9E,EAAKgB,SAASe,UAAUiD,WAAa,SAAUP,GAC7C,MAAMQ,EAAKR,EAAQQ,GAAGC,QAAQ,UAAW,IACzC,OAAOC,OAAOF,GAAM,GAOtBjF,EAAKgB,SAASe,UAAUyB,YAAc,SAAUiB,GAQ9C,GAPAA,EAAQnB,aAAa,gBAAiB,QACtClC,KAAKE,MAAMgC,aAAa,wBAAyBmB,EAAQQ,IAIzD7D,KAAKgD,aAAahD,KAAKQ,cAEnBR,KAAKG,QAAQ6D,aAAehE,KAAKG,QAAQ8D,aAAc,CACzD,MAAMC,EAAelE,KAAKG,QAAQ8D,aAAejE,KAAKG,QAAQgE,UACxDC,EAAgBf,EAAQgB,UAAYhB,EAAQiB,aAC9CF,EAAgBF,EAClBlE,KAAKG,QAAQgE,UAAYC,EAAgBpE,KAAKG,QAAQ8D,aAC7CZ,EAAQgB,UAAYrE,KAAKG,QAAQgE,YAC1CnE,KAAKG,QAAQgE,UAAYd,EAAQgB,aASvCzF,EAAKgB,SAASe,UAAUsB,cAAgB,SAAUoB,GAC3CA,GAGLA,EAAQnB,aAAa,gBAAiB,UAGxC,MAAiBtD,GCpTF,WACb,MAAM2F,EAAa3D,SAAS+C,eAAe,UACrCa,EAAe5D,SAAS+C,eAAe,iBACvCc,EAAWF,EAAW5B,QAAQ+B,YAC9BC,EAAQ,GAWd,SAASC,EAAe1E,GActB,OArBF,SAAqB2E,EAAaF,GAChC,OAAOA,EAAMG,OAAOC,IAClB,MAAMC,EAAQ,IAAIC,OAAOJ,EAAa,MACtC,OAAOE,EAAKG,MAAMC,MAAMH,KAKLI,CAAYlF,EAAOyE,GACZU,IAAIN,IAC9B,MAAMlC,EAAO,2CACqBkC,EAAKO,oBAAoBP,EAAKG,qDAC3BH,EAAKG,2BAG1C,MAAO,CACLrD,MAAOkD,EAAKG,MACZrC,KAAAA,KCvBgBjC,SAASsC,iBAAiB,2BAElCqC,QAAQC,IACpB,IAAIjE,EAASiE,EAAaC,mBAE1BD,EAAaE,QAAU,KACnB,IAAIC,EAAuD,QAA5CH,EAAajC,aAAa,iBAA4B,EAErEiC,EAAatD,aAAa,eAAgByD,GAC1CpE,EAAOqE,UAAUC,OAAO,2BACxBtE,EAAOwB,OAAS4C,EAChB/E,SAAS+C,eAAe,gBAAgBmC,WDmB1CvB,IACFwB,MAAMtB,GACHuB,KAAKC,GAAQA,EAAKC,QAClBF,KAAKG,GAAQxB,EAAMyB,QAAQD,IAE9B5B,EAAWrC,aAAa,SAAU,WAClCqC,EAAW8B,gBAAgB,UAC3B7B,EAAa8B,WAAWC,YAAY/B,GAEpCgC,OAAO1F,iBAAiB,OAAQ,IACvB,IAAIlC,EAAKgB,SACdgB,SAAS+C,eAAe,mBACxB/C,SAAS+C,eAAe,gBACxBiB"}